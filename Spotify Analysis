-- For this project, I downloaded Spotify data from Kaggle, created a table to insert the data into, and analyzed the data by asking the questions and providing the insights listed below.

-- Created the table using the following:
CREATE TABLE bit_db.spotifydata 
  ( 
     id               INTEGER PRIMARY KEY, 
     artist_name      VARCHAR NOT NULL, 
     track_name       VARCHAR NOT NULL, 
     track_id         VARCHAR NOT NULL, 
     popularity       INTEGER NOT NULL, 
     danceability     DECIMAL(4, 3) NOT NULL, 
     energy           DECIMAL(4, 3) NOT NULL, 
     song_key         INTEGER NOT NULL, 
     loudness         DECIMAL(5, 3) NOT NULL, 
     song_mode        INTEGER NOT NULL, 
     speechiness      DECIMAL(5, 4) NOT NULL, 
     acousticness     DECIMAL(6, 5) NOT NULL, 
     instrumentalness DECIMAL(8, 7) NOT NULL, 
     liveness         DECIMAL(5, 4) NOT NULL, 
     valence          DECIMAL(4, 3) NOT NULL, 
     tempo            DECIMAL(6, 3) NOT NULL, 
     duration_ms      INTEGER NOT NULL, 
     time_signature   INTEGER NOT NULL 
  ) 

-- Inserted the spotify_top50_2021.csv file downloaded from Kaggle into the table using SQLiteStudio.


-- Orders artists by average acousticness and lists the artist's tracks.
SELECT artist_name, 
       track_name, 
       acousticness, 
       Avg(acousticness) 
         OVER ( 
           partition BY artist_name) AS avg_acousticness 
FROM   bit_db.spotifydata 
ORDER  BY avg_acousticness DESC; 

-- What track is the most likely to uplift mood? According to Rita Steblin in History of Key Characteristics in the Eighteenth and Early Nineteenth Centuries, F# major is associated with triumph over difficulty, therefore, song_key = 6.
SELECT artist_name, 
       track_name 
FROM   bit_db.spotifydata 
WHERE  song_mode = 1 
       AND song_key = 6; 

-- What is each artist's loudest track?
SELECT artist_name, 
       track_name AS loudest_track, 
       loudness 
FROM   bit_db.spotifydata 
GROUP  BY artist_name;

-- What tracks are similar to the top three tracks with the highest average danceability and energy?
SELECT a.track_name, 
       Nullif(b.track_name, a.track_name) AS similar_track 
FROM   spotifydata a 
       LEFT JOIN spotifydata b 
              ON a.danceability = b.danceability BETWEEN ( a.danceability - 0.5 
                                                         ) AND ( 
                                                         a.danceability + 0.5 ) 
                                            BETWEEN ( a.energy - 0.5 ) AND ( 
                                                    a.energy + 0.5 ) 
WHERE  a.track_name IN (SELECT track_name 
                        FROM   bit_db.spotifydata 
                        ORDER  BY ( danceability + energy ) / 2 
                        LIMIT  3); 
